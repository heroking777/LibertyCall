# Intent動作確認用 質問リスト

**作成日**: 2025-12-27  
**目的**: intent_rules.py の修正後、各Intentが正しく動作するか確認

---

## 1. NOT_HEARD (聞き取れない)

### 判定条件
- ノイズ・聞き取れない発話
- "ゴニョゴニョ"、特殊文字3文字以上

### テスト質問
1. "ゴニョゴニョ"
2. "あー、えー、うー"
3. "###"
4. "…。、。、"

### 期待結果
- **テンプレートID**: `["0602"]`
- **応答内容**: "恐れ入ります、少し聞き取りづらかったようです。もう一度お願いできますでしょうか？"

---

## 2. GREETING (挨拶)

### 判定条件
- 挨拶表現

### テスト質問
1. "もしもし"
2. "こんにちは"
3. "お世話になります"
4. "はじめまして"

### 期待結果
- **テンプレートID**: `["004"]`
- **応答内容**: "もしもし。"

---

## 3. INQUIRY (問い合わせ)

### 判定条件
- 問い合わせ意図（修正後: 条件分岐削除）

### テスト質問
1. "ホームページを見て電話しました"
2. "システムについて詳しく聞きたい"
3. "導入を検討しています"
4. "サービスについて教えてください"
5. "メールが来ていたので電話しました"

### 期待結果
- **テンプレートID**: `["006"]` ← **修正後: すべて006のみ**
- **応答内容**: "導入のご相談でよろしかったでしょうか？"

---

## 4. PRICE (料金)

### 判定条件
- 料金に関する質問（修正後: 条件分岐削除）

### テスト質問
1. "料金はいくらですか？"
2. "初期費用はかかりますか？"
3. "月額いくらですか？"
4. "解約料はありますか？"
5. "トライアルはありますか？"
6. "費用について教えてください"

### 期待結果
- **テンプレートID**: `["040"]` ← **修正後: すべて040のみ**
- **応答内容**: "料金は月額二十万円となります。"

---

## 5. FUNCTION (機能)

### 判定条件
- 機能に関する質問（修正後: 条件分岐削除）

### テスト質問
1. "どんな機能がありますか？"
2. "セキュリティは大丈夫ですか？"
3. "転送機能はありますか？"
4. "間違った案内をしませんか？"
5. "録音データはどうなりますか？"
6. "個人情報の取り扱いは？"

### 期待結果
- **テンプレートID**: `["023"]` ← **修正後: すべて023のみ**
- **応答内容**: "AIが電話応対し、必要に応じて担当者へ引き継ぎます。"

---

## 6. SETUP (設定)

### 判定条件
- 設定・導入に関する質問（修正後: 条件分岐削除）

### テスト質問
1. "すぐに使えますか？"
2. "いつから使えますか？"
3. "設定は難しいですか？"
4. "どうやって導入しますか？"
5. "パソコンは必要ですか？"

### 期待結果
- **テンプレートID**: `["060"]` ← **修正後: すべて060のみ**
- **応答内容**: "最短即日から導入が可能です。"

---

## 7. SYSTEM_EXPLAIN (システム説明)

### 判定条件
- システムについての説明要求

### テスト質問
1. "どういうシステムですか？"
2. "どんなシステムなの？"
3. "システムの仕組みを教えて"
4. "どういうサービスですか？"

### 期待結果
- **テンプレートID**: `["020"]` ← **修正後: 4つ→1つ**
- **応答内容**: "当社のAI電話は二十四時間三百六十五日対応で、一次受付から要件確認まで自動で行います。"

---

## 8. HANDOFF_YES (ハンドオフ承認)

### 判定条件
- ハンドオフ確認中の肯定応答

### テスト質問（context="handoff_confirming"の状態で）
1. "はい"
2. "お願いします"
3. "大丈夫です"
4. "はい、お願いします"

### 期待結果
- **テンプレートID**: `["081", "082"]` ← **修正後: 空リスト→明示的**
- **応答内容**: 
  - 081: "それでは担当者におつなぎいたします。"
  - 082: "しばらくお待ちください。"

---

## 9. HANDOFF_NO (ハンドオフ拒否)

### 判定条件
- ハンドオフ確認中の否定応答

### テスト質問（context="handoff_confirming"の状態で）
1. "いいえ"
2. "大丈夫です"
3. "結構です"
4. "今日は聞くだけです"

### 期待結果
- **テンプレートID**: `["086", "087"]` ← **修正後: 空リスト→明示的**
- **応答内容**:
  - 086: "お電話ありがとうございました。"
  - 087: "また何かあればいつでもご相談くださいね。"

---

## 10. HANDOFF_REQUEST (担当者接続希望)

### 判定条件
- 担当者への接続希望

### テスト質問
1. "担当者と話したい"
2. "詳しい人に代わってください"
3. "人間と話せますか？"
4. "オペレーターにつないでください"
5. "担当者お願いします"

### 期待結果
- **テンプレートID**: `["0604"]` ← **修正後: 空リスト→明示的**
- **応答内容**: "私では詳細のご案内が難しい内容のため、担当者におつなぎしてもよろしいでしょうか？"

---

## 11. END_CALL (終了)

### 判定条件
- 会話終了の意図

### テスト質問
1. "もう大丈夫です"
2. "ありがとうございました"
3. "結構です"
4. "以上です"
5. "他はありません"

### 期待結果
- **テンプレートID**: `["086"]` ← **修正後: 3つ→1つ**
- **応答内容**: "お電話ありがとうございました。"

---

## 12. RESERVATION (予約機能)

### 判定条件
- 予約機能に関する質問（修正後: 条件分岐削除、085削除）

### テスト質問
1. "予約機能はありますか？"
2. "ダブルブッキングは防げますか？"
3. "予約のキャンセルはできますか？"
4. "席の予約管理はできますか？"
5. "スタッフ別の予約はできますか？"

### 期待結果
- **テンプレートID**: `["070"]` ← **修正後: 常に2つ→1つ、085削除**
- **応答内容**: "予約の取得や変更、キャンセルにも柔軟に対応可能です。"

---

## 13. MULTI_STORE (複数店舗)

### 判定条件
- 複数店舗対応の質問

### テスト質問
1. "複数店舗で使えますか？"
2. "店舗がいくつかあるんですが"
3. "別店舗でも使えますか？"
4. "複数拠点で使えますか？"

### 期待結果
- **テンプレートID**: `["069"]` ← **修正後: 2つ→1つ、085削除**
- **応答内容**: "複数拠点・複数番号の管理にも対応しております。"

---

## 14. DIALECT (方言)

### 判定条件
- 方言対応の質問

### テスト質問
1. "関西弁で話せますか？"
2. "方言には対応していますか？"
3. "イントネーションは大丈夫ですか？"

### 期待結果
- **テンプレートID**: `["066"]` ← **修正後: 2つ→1つ、085削除**
- **応答内容**: "方言やイントネーションにも柔軟に対応いたします。"

---

## 15. INTERRUPT (割り込み)

### 判定条件
- 割り込み対応の質問

### テスト質問
1. "途中で話しても大丈夫？"
2. "口挟んでもいいですか？"
3. "割り込んでも大丈夫ですか？"

### 期待結果
- **テンプレートID**: `["065"]` ← **修正後: 2つ→1つ、085削除**
- **応答内容**: "リアルタイムで発話割り込みに対応いたします。"

---

## 16. BUSY (混雑)

### 判定条件
- 混雑状況の質問

### テスト質問
1. "混んでますか？"
2. "込み合ってますか？"
3. "混雑していますか？"

### 期待結果
- **テンプレートID**: `["090"]` ← **修正後: 2つ→1つ**
- **応答内容**: "現在込み合っております。"

---

## 17. SALES_CALL (営業電話)

### 判定条件
- 営業電話の判定（条件分岐あり）

### テスト質問
1. "営業の電話です" → `["094", "088"]`
2. "はい営業です" → `["094", "088"]`
3. "営業目的のお電話でしょうか？" → `["093"]`

### 期待結果
- **テンプレートID**: 
  - "営業" または "はい営業" を含む場合: `["094", "088"]`
  - その他: `["093"]`
- **応答内容**: 
  - 094: "恐れ入りますが、営業目的のご連絡はお受けしておりません。"
  - 088: "失礼いたします。"
  - 093: "営業目的のお電話でしょうか？"

---

## 18. AI_CALL_TOPIC (AI電話の件)

### 判定条件
- AI電話に関する質問

### テスト質問
1. "AI電話の件で"
2. "AIの電話について"
3. "AI電話の件です"

### 期待結果
- **テンプレートID**: `["0600"]`
- **応答内容**: "AI電話の件ですね。どのあたりが気になっておりますでしょうか？"

---

## 19. AI_IDENTITY (AIの正体)

### 判定条件
- AIの正体に関する質問

### テスト質問
1. "あなたはAIですか？"
2. "AIがやってるんですか？"
3. "ロボットですか？"
4. "自動応答ですか？"

### 期待結果
- **テンプレートID**: `["023_AI_IDENTITY"]`
- **応答内容**: "はい、私がAIで自動応答させていただいております。内容によっては担当者におつなぎする場合もございますが、わかる範囲でご案内いたします。"

---

## 20. SYSTEM_INQUIRY (システムについての問い合わせ)

### 判定条件
- システムについての問い合わせ（優先度高い）

### テスト質問
1. "システムについて聞きたい"
2. "システムの使い方を教えて"
3. "システムについて詳しく"

### 期待結果
- **テンプレートID**: `["006_SYS"]`
- **応答内容**: "ありがとうございます。システムについてですね。どのような点が気になっていますか？"

---

## 21. INQUIRY_PASSIVE (温度の低いリード)

### 判定条件
- 検討中・迷っている表現

### テスト質問
1. "まだ検討中です"
2. "迷っているところです"
3. "様子を見ています"
4. "まだそこまでは考えてない"

### 期待結果
- **テンプレートID**: `["089"]` または `["090"]` ← **ランダム選択**
- **応答内容**: 
  - 089: "ありがとうございます。ちなみに、どのあたりがご不安でしたか？"
  - 090: "かしこまりました。どこか気になる点や迷っている部分はございますか？"

---

## 22. SUPPORT (サポート)

### 判定条件
- サポートに関する質問（条件分岐あり）

### テスト質問
1. "サポートはありますか？" → `["0284"]`
2. "不具合があったらどうしますか？" → `["0285"]`
3. "故障した場合は？" → `["0285"]`
4. "エラーが出たら？" → `["0285"]`

### 期待結果
- **テンプレートID**: 
  - "不具合"、"故障"、"エラー"、"障害" を含む場合: `["0285"]`
  - その他: `["0284"]`
- **応答内容**: 
  - 0284: "導入後もチャット・電話でのサポートが可能です。"
  - 0285: "不具合があれば即日対応し、自動復旧機能も備えています。"

---

## 23. CALLBACK_REQUEST (折り返しリクエスト)

### 判定条件
- 折り返し電話の希望

### テスト質問
1. "折り返してください"
2. "かけ直してください"
3. "折り返しお願いします"

### 期待結果
- **テンプレートID**: `["0601"]`
- **応答内容**: "承知いたしました。折り返し希望として承ります。お名前とご連絡先をお伺いしてもよろしいでしょうか？"

---

## 24. SETUP_DIFFICULTY (設定難易度)

### 判定条件
- 設定の難易度に関する質問

### テスト質問
1. "設定は難しいですか？"
2. "設定むずい？"
3. "設定するのが大変ですか？"

### 期待結果
- **テンプレートID**: `["0603"]`
- **応答内容**: "初期設定はこちらで代行いたしますので、お店側の作業はほとんどございません。スマホだけでもご利用いただけますのでご安心ください。"

---

## 25. UNKNOWN (不明)

### 判定条件
- どのIntentにも該当しない発話

### テスト質問
1. "あいうえお"
2. "かきくけこ"
3. "意味不明な文字列"

### 期待結果
- **テンプレートID**: `["114"]`
- **応答内容**: "ご要件をもう一度お伺いしてもよろしいでしょうか？"

---

## 26. デフォルト（どのIntentにも該当しない場合）

### 判定条件
- select_template_ids()の最後のreturn文

### テスト質問
- （通常は発生しないが、念のため）

### 期待結果
- **テンプレートID**: `["110"]`
- **応答内容**: "もしもし？お声が遠いようです。もう一度お願いします。"

---

## 修正内容のまとめ

### 修正前 → 修正後

| Intent | 修正前 | 修正後 | 変更内容 |
|--------|--------|--------|---------|
| SYSTEM_EXPLAIN | `["020", "023", "021", "085"]` (4つ) | `["020"]` | 4つ→1つ |
| END_CALL | `["086", "087", "088"]` (3つ) | `["086"]` | 3つ→1つ |
| INQUIRY | 5分岐（条件によって異なる） | `["006"]` | 条件分岐削除、常に006 |
| PRICE | 7分岐（条件によって異なる） | `["040"]` | 条件分岐削除、常に040 |
| FUNCTION | 8分岐（条件によって異なる） | `["023"]` | 条件分岐削除、常に023 |
| SETUP | 3分岐（条件によって異なる） | `["060"]` | 条件分岐削除、常に060 |
| RESERVATION | 4分岐、常に2つ返す | `["070"]` | 条件分岐削除、常に070、085削除 |
| MULTI_STORE | `["069", "085"]` (2つ) | `["069"]` | 2つ→1つ、085削除 |
| DIALECT | `["066", "085"]` (2つ) | `["066"]` | 2つ→1つ、085削除 |
| INTERRUPT | `["065", "085"]` (2つ) | `["065"]` | 2つ→1つ、085削除 |
| BUSY | `["090", "098"]` (2つ) | `["090"]` | 2つ→1つ |
| HANDOFF_YES | `[]` (空リスト) | `["081", "082"]` | 空リスト→明示的 |
| HANDOFF_NO | `[]` (空リスト) | `["086", "087"]` | 空リスト→明示的 |
| HANDOFF_REQUEST | `[]` (空リスト) | `["0604"]` | 空リスト→明示的 |

---

## テスト実行方法

### 手動テスト
1. 上記の質問を1つずつ入力
2. 期待されるテンプレートIDが返ってくるか確認
3. 応答内容が正しいか確認

### 自動テスト（推奨）
```bash
# intent_rules.pyのテスト
python3 -m pytest tests/test_intent_rules.py -v

# または個別にテスト
python3 -c "
from libertycall.gateway.intent_rules import classify_intent, select_template_ids

# テストケース
test_cases = [
    ('ゴニョゴニョ', 'NOT_HEARD', ['0602']),
    ('もしもし', 'GREETING', ['004']),
    ('料金はいくらですか？', 'PRICE', ['040']),
    ('担当者お願いします', 'HANDOFF_REQUEST', ['0604']),
]

for text, expected_intent, expected_templates in test_cases:
    intent = classify_intent(text)
    templates = select_template_ids(intent, text)
    status = '✓' if intent == expected_intent and templates == expected_templates else '✗'
    print(f'{status} {text!r} → intent={intent}, templates={templates}')
"
```

---

## 注意事項

1. **HANDOFF_YES/NO**: context="handoff_confirming"が必要なため、通常のclassify_intent()では正しく判定されない可能性があります。実際のテストでは`interpret_handoff_reply()`を使用してください。

2. **INQUIRY_PASSIVE**: ランダム選択のため、同じ質問でも異なるテンプレートが返る可能性があります。

3. **SALES_CALL/SUPPORT**: 条件分岐が残っているため、質問内容によって返るテンプレートが異なります。

4. **テンプレートID "089"**: 重複定義がありますが、INQUIRY_PASSIVEでは85行目の定義（"かしこまりました。どこか気になる点や迷っている部分はございますか？"）が使用される想定です。

