# 接続問題のトラブルシューティング

## 現在の状態

✅ **サーバー側の設定は正常です：**
- Viteサーバー: ポート5173で起動中
- ファイアウォール: ポート5173と8000が開放済み
- リッスン設定: 0.0.0.0でリッスン中（外部アクセス可能）

## 外部からアクセスできない場合の確認事項

### 1. VPSプロバイダー側のセキュリティグループ設定

多くのVPSプロバイダー（AWS、GCP、Azure、さくらのVPSなど）では、**セキュリティグループ**や**ファイアウォール設定**でポートを開放する必要があります。

**確認方法：**
- VPSの管理画面にログイン
- セキュリティグループ/ファイアウォール設定を確認
- ポート5173（TCP）が開放されているか確認

### 2. ポート開放の確認コマンド

サーバー側で以下を実行：

```bash
# ポートがリッスンしているか確認
netstat -tlnp | grep 5173

# ファイアウォール設定確認
sudo ufw status | grep 5173

# ローカル接続テスト
curl http://localhost:5173

# IPアドレス接続テスト（サーバー内から）
curl http://160.251.170.253:5173
```

### 3. 外部からの接続テスト

別のマシンやオンラインツールからテスト：

```bash
# 別のマシンから（可能な場合）
curl -v http://160.251.170.253:5173

# またはオンラインツールを使用
# https://www.yougetsignal.com/tools/open-ports/
# ポート: 5173, IP: 160.251.170.253
```

### 4. ブラウザ側の確認

- **キャッシュをクリア**: Ctrl+Shift+Delete
- **シークレットモードで試す**: Ctrl+Shift+N (Chrome)
- **別のブラウザで試す**: Firefox、Edgeなど
- **プロキシ設定を確認**: 企業ネットワークなどでプロキシが設定されている場合

### 5. 一時的な解決策：ポート80または443を使用

もしポート5173が外部からアクセスできない場合、既に開放されているポート（80、443、3000など）を使用できます：

```bash
# vite.config.jsでポートを変更
# port: 3000  # 既に開放されているポート
```

### 6. ログの確認

```bash
# Viteのログを確認
tail -f /tmp/vite.log

# システムログを確認
sudo journalctl -u ufw -n 50
```

## 現在のサーバー状態

```bash
# サーバー状態確認スクリプト
cd /opt/libertycall
./test_connection.sh
```

## サポートが必要な場合

以下の情報を提供してください：
1. 使用しているVPSプロバイダー名
2. エラーメッセージのスクリーンショット
3. ブラウザの開発者ツール（F12）のNetworkタブの内容

